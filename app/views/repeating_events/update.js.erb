
$('#tooltip').remove();
<% if @repeating_event.is_set_of_timeslots? and !params[:calendar] %>
   <% @period_start = params[:rerender_date] ? Date.parse(params[:rerender_date]).previous_sunday : Date.today.previous_sunday %>
   <% @period_start = params[:date] ? Date.parse(params[:date]).previous_sunday : @period_start %>
   <% @dept_start_hour = current_department.department_config.schedule_start / 60 %>
   <% @dept_end_hour = current_department.department_config.schedule_end / 60 %>
   <% @hours_per_day = (@dept_end_hour - @dept_start_hour) %>
   <% @block_length = current_department.department_config.time_increment %>
   <% @blocks_per_hour = 60/@block_length.to_f %>
   <% @blocks_per_day = @hours_per_day * @blocks_per_hour %>
   <% @hidden_timeslots = [] %>

   <% @repeating_event.locations.each do |location| %>
      $("#location<%=location.id%>").html('<%= j render partial: "time_slots/location", object: location %>');
      initialize('#location<%=location.id%>');
   <% end %>

<% else %>
  <% rerender_start_date = Date.parse(params[:rerender_date]).previous_sunday %>
  <% rerender_start_date.wday.upto(6) do |n| %>
    <% if @repeating_event.days.include?(n.day_of_week)%>
      <% current_date = rerender_start_date + n.days %>
        $('#<%=current_date.strftime("%Y-%m-%d")%>').html('<%= j render partial: (params[:calendar] ? "calendars/schedule/day" : "shifts/schedule/day"), object: current_date.to_date%>');
        initialize('#<%=current_date.strftime("%Y-%m-%d")%>');
    <% end %>
  <% end %>
<% end %>

$('#flash').html("<%= escape_javascript render partial: 'layouts/flash', locals: {flash: flash} %>");
var new_div = $("<div class='AJAX_alert'>event(s) updated</div>").prependTo("#AJAX_status");
new_div.slideDown().effect("highlight").delay(2500).slideUp();
<% flash.discard %>
