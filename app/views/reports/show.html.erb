<% title "Sea Voyage aboard the #{@report.shift.location.name}"%>

<% if current_user == @report.user && !@report.departed %>
	
	<fieldset class = "index" >
	<legend>Tactical Simulation Room</legend>
	<div id = "battleshifts">
	</div>
	
	
	<div id = "left_stuff">
		
	  <fieldset class = "index" id = "report_message_center">
	    <legend><%= "Radio room for the #{@report.shift.location.short_name}"%></legend>
	    <div id = "message_center">
	    	<%= render :partial => 'notices/notice', :collection => @report.get_notices, :locals => {:html_class => "report_notice"} %> </div>
	    <div id="new_notice">
	    <%= link_to_post_a_sticky() %> <%= link_to_post_an_announcement %>
	    </div>
	  </fieldset>
	
	  <% unless mobile_device?%>
	  	<%= periodically_call_remote :url => { :controller => "notices", :action => "update_message_center"}, :frequency => 240 -%>
	  <% end %>
	</div>
	
	<div id = "right_stuff">

	   <fieldset id = "report_data_objects" class = "index">
	     <legend>Logistics</legend>
	     <%= render :partial => 'data_objects/report_data_object' %>
	   </fieldset>

	  <fieldset id = "useful_links" class = "index" >
	    <legend>Useful Remote Communications</legend>
	   	<%= render :partial => 'links/report_links' %>
	  </fieldset>

	  <% unless mobile_device?%>
	    <%# TODO: Re-enable this once we figure out why it's crashing%>
		<%#= periodically_call_remote :url => { :controller => "tasks", :action => "update_tasks"}, :frequency => 60 -%>
	  <% end %>

	  <fieldset id = "shift_tasks" class= "index">
		<legend>Naval Duties</legend>
		<div id = "tasks">
	    <%= render :partial => 'tasks/report_tasks' %>
		</div>
	  </fieldset>

	  <fieldset id="searchbox" class = "index">
	    <legend><%= "Search " + "#{@search_engine_name}"%></legend>
	    <%= render :partial => 'reports/search'%>
	  </fieldset>
	</div>

  <div id="active_report_area">
        <h2><%= current_user.rank %>'s Logbook</h2>
        <%= render :partial => 'new_report_item_form' %>
  <div id="report_relative_size">
		<% unless mobile_device? %>
	    	<%# TODO: Re-enable this once we figure out why it's crashing%>
			<%#= periodically_call_remote :url => { :controller => "reports", :action => "update_reports", :id => @report.id}, :frequency => 30 -%>
		<% end %>
		
<% end %>


 <% if current_user == @report.user && !@report.departed %>
       <%= render :partial => 'report', :locals => {:html_id => "dashboard_report_view"}%>
 <% else %>
     <%= render :partial => 'report', :locals => {:html_id => "report_view"}%>
 <% end %>

 <% if @report.shift.signed_in? && (current_user != @report.shift.user && current_user.is_admin_of?(@report.shift.loc_group)) %>
 	<%= button_to "Disembark from vessel", {:controller => 'reports', :action => :update, :id => @report, :sign_out => true, :method => :put}, :confirm => 'Are you sure you wish to sign the user out of this shift?' %>
 <% end %>

 <% if current_user == @report.user && !@report.departed %>

</div> <!-- close report_relative_size -->

 <%= button_to "Disembark from vessel", {:action => :update, :id => @report, :sign_out => true, :method => :put}, :confirm => 'Are you sure you wish to sign out of this shift?' %>

<div class='clear'></div>
</div> <!--close active_report_area -->


<% end %>

<script type="text/javascript">
imagePreload();
player = setupPlayer(false);
computer = setupPlayer(true);
$('#battleshifts').append("<center><em>Simulator more accurate when run in Chrome/Safari</em><table><tr><td align=center><p class='heading'>OPPONENT'S FLEET</p></td>"+
"<td align=center><p class='heading'>YOUR FLEET</p></td></tr><tr id='game'><td id=\"opponent\">");
showGrid(true);
$('#game').append("</td><td id=\"player\">");
showGrid(false);
$('#game').append("</td></tr></table></center>");
updateStatus();
setInterval("setStatus();", 500);
</script>