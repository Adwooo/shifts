<h1>Stats</h1>

<% form_tag 'stats' do |f| %>
  <p>
    <%= label_tag :start_date %><br />
    <%=  text_field_tag 'start_date', "#{@start_date}" %>
  </p>
  <p>
    <%= label_tag :end_date %><br />
    <%=  text_field_tag 'end_date', "#{@end_date}" %>
  </p>
  <div><%= submit_tag 'Update dates' %></div>
<% end -%>

<table id="stats_table" class="tablesorter">
  <thead>
    <tr>
      <th align="left">Name</th>
      <th align="left">Total Shifts</th>
      <th align="left">Late</th>
      <th align="left">Left Early</th>
      <th align="left">Missed</th>
			<th align="left">Updates/Hour</th>
    </tr>
  </thead>
  <tbody id="user_list">
    <% @stats.each do |key, stat| %>
      <tr class="master">
        <td><span class="arrow"></span><%= link_to stat[:name], {:controller => :stats, :action => 'for_user', :id => stat[:u], :start_date => @start_date, :end_date => @end_date } %></td>
        <td><%=h stat[:num_shifts] %></td>
        <td><%=h stat[:num_late] %></td>
        <td><%=h stat[:num_left_early] %></td>
        <td><%=h stat[:num_missed] %></td>
				<td><%=h stat[:updates] %></td>
      </tr>
			
				<% @my_stats = stat[:u].detailed_stats(@start_date, @end_date) %>
				<% @my_stats.each do |shift_id, stat_entry| %>
				<tr>
					<td colspan="2"><%= stat_entry[:location] %></td>
					<td colspan="1"><%= stat_entry[:start] %></td>
					<td colspan="1"><%= stat_entry[:end] %></td>
					<td colspan="1"><%= stat_entry[:notes] %></td>
					<td colspan="1"><%= stat_entry[:updates] %></td>
				</tr>
				<% end %>

    <% end %>
  </tbody>
</table>

<script type="text/javascript">
$(document).ready(function(){
  $("#user_list tr:not(.master)").hide();
  $("#user_list tr.master").click(function(){
      $(this).next("tr").toggle();
      $(this).find(".arrow").toggleClass("up");
  }); 

  
  //$.tablesorter.defaults.widgets = ['zebra'];
  //$("#stats_table").tablesorter({
  //  sortList: [[0,0]]
  //});
});
</script>
