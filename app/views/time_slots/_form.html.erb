<% calculate_default_times %>

    <% if params[:calendar] %>
      <%= (f.hidden_field :calendar_id, :value => params[:calendar].to_i) unless params[:calendar].to_i == 0 %>
    <% else %>
      <p>
        <%= f.label :calendar %><br />
        <%= select_tag 'time_slot[calendar_id]', options_from_collection_for_select(current_department.calendars, :id, :name, params[:calendar].to_i)%>
      </p>
    <% end %>

    <% if @time_slot.new_record? && !params[:xPercentage]%>
      <p>
          <strong>Days:</strong><br />
        <% WEEK_DAYS.each_with_index do |day, i| %>
          <%= check_box_tag "days[]", i, false, {:id => "days_#{i}"} %>
          <%= day %>
        <% end %>
      </p>
    <% end %>

      <p>
        <%= f.label :start %><br />
        <%= f.hidden_field :start_date, :value => @default_start_date %>
        <%= f.time_select :start_time, {
                :simple_time_select => true,
                :time_separator => "",
                :minute_interval => @department.department_config.time_increment,

                :start_time => @range_start_time,
                :end_time => @range_end_time,

                :default => @time_slot.start,
                :include_start_time => true,
                :include_end_time => false,
                                          } %>
      </p>
      <p>
        <%= f.label :end %><br />
        <%#= f.hidden_field :end_date, :value => @default_end_date %>
        <%= f.time_select :end_time, {
                :simple_time_select => true,
                :time_separator => "",
                :minute_interval => @department.department_config.time_increment,

                :start_time => @range_start_time,
                :end_time => @range_end_time,

                :default => @time_slot.end,
                :include_start_time => false,
                :include_end_time => true,
                                          } %>
      </p>

<% #we could still simplify the first two sections of this conditional. In the tooltip (elsif part), locations wrap around, that's all. %>
    <% if @time_slot.new_record? && !params[:xPercentage]%>
    <%# if we're on the html new page, give locations as checkboxes
        but remove this later? %>
        <% @department.loc_groups.each do |loc_group| %>
          <% unless loc_group.locations.empty? %>
            <p>
              <strong><%= loc_group.name %></strong><br/>
              <% loc_group.locations.each do |loc| %>
                <%= check_box_tag "location_ids[]", loc.id, false, {:id => "location_#{loc.id}"} %>
                <%= loc.short_name %>
              <% end %>
            </p>
          <% end %>
        <% end %>
    <% else %>
    <%# if we're in a tooltip, use a location dropdown %>
      <p>
        <%= f.label :location %><br />
        <%= select_tag 'time_slot[location_id]', option_groups_from_collection_for_select(@department.loc_groups, :locations, :name, :id, :name, @time_slot.location_id)%><br />
      </p>
    <% end %>

  </p>
  <%= (hidden_field_tag 'date', params[:date]) if params[:date] %>

